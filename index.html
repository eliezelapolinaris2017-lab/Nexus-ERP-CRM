<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Oasis • ERP Cloud</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Firebase (modular) -->
  <script type="module" src="firebase.js"></script>
  <script type="module" src="app.js" defer></script>
</head>
<body>
  <!-- LOGIN (overlay bloqueante) -->
  <div id="loginView" class="view active" role="dialog" aria-modal="true" aria-label="Acceso">
    <div class="auth-card">
      <h1>Oasis • ERP Cloud</h1>
      <p class="muted">Inicia sesión con tu correo y contraseña.</p>
      <div class="row">
        <label for="email">Email</label>
        <input id="email" type="email" placeholder="usuario@empresa.com" autocomplete="username"/>
      </div>
      <div class="row">
        <label for="password">Password</label>
        <input id="password" type="password" placeholder="••••••••" autocomplete="current-password"/>
      </div>
      <div class="row">
        <button id="loginBtn">Entrar</button>
        <button id="signupBtn" class="outline">Crear cuenta</button>
        <button id="resetBtn" class="link">Olvidé mi clave</button>
      </div>
      <p id="authMsg" class="muted" role="status"></p>
    </div>
  </div>

  <!-- APP -->
  <div id="appView" class="view" inert aria-hidden="true">
    <aside class="sidebar">
      <div class="brand">
        <img id="brandImg" class="brand-img" alt="logo"/>
        <div class="logo">Oasis • ERP Cloud</div>
      </div>
      <nav>
        <button data-nav="dashboard" class="nav-btn active">Dashboard</button>
        <button data-nav="finanzas" class="nav-btn">Finanzas</button>
        <button data-nav="crm" class="nav-btn">CRM</button>
        <button data-nav="inventario" class="nav-btn">Inventario</button>
        <button data-nav="analytics" class="nav-btn">Analytics</button>
        <button data-nav="settings" class="nav-btn">Configuración</button>
      </nav>
      <div class="sidebar-footer">
        <button id="exportCsvBtn" class="small">CSV Productos</button>
        <button id="logoutBtn" class="small outline">Salir</button>
      </div>
    </aside>

    <main class="main">
      <!-- DASHBOARD -->
      <section id="dashboard" class="page active">
        <h2>Dashboard General</h2>
        <div class="grid">
          <div class="card"><div class="kpi"><div class="kpi-title">Ingresos (mes)</div><div id="kpiIncome" class="kpi-value">—</div></div></div>
          <div class="card"><div class="kpi"><div class="kpi-title">Gastos (mes)</div><div id="kpiExpense" class="kpi-value">—</div></div></div>
          <div class="card"><div class="kpi"><div class="kpi-title">Clientes</div><div id="kpiClients" class="kpi-value">—</div></div></div>
          <div class="card"><div class="kpi"><div class="kpi-title">SKUs</div><div id="kpiSkus" class="kpi-value">—</div></div></div>
        </div>
        <h3 class="mt">Bajo Inventario</h3>
        <table class="table" id="lowStockTable">
          <thead><tr><th>SKU</th><th>Nombre</th><th>Stock</th><th>Mínimo</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- FINANZAS -->
      <section id="finanzas" class="page">
        <div class="page-header">
          <h2>Finanzas (ERP)</h2>
          <div class="actions">
            <button id="addAccountBtn">Nueva Cuenta</button>
            <button id="addTxnBtn">Ingreso/Gasto</button>
            <button id="addInvoiceBtn">Factura</button>
            <button id="pdfFinBtn" class="outline">PDF Resumen (B/N)</button>
            <button id="pdfTxBtn" class="outline">PDF Transacciones (B/N)</button>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <h3>Cuentas</h3>
            <table class="table" id="accTable">
              <thead><tr><th>Nombre</th><th>Tipo</th><th>Saldo</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Transacciones</h3>
            <div class="row">
              <input id="txnSearch" placeholder="Buscar por descripción..."/>
            </div>
            <table class="table" id="txnTable">
              <thead><tr><th>Fecha</th><th>Cuenta</th><th>Tipo</th><th>Monto</th><th>Descripción</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Facturas</h3>
            <table class="table" id="invTable">
              <thead><tr><th>#</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CRM -->
      <section id="crm" class="page">
        <div class="page-header">
          <h2>CRM</h2>
          <div class="actions">
            <button id="addClientBtn">Nuevo Cliente</button>
            <button id="addLeadBtn">Nuevo Lead</button>
            <button id="addActivityBtn">Actividad</button>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <h3>Clientes</h3>
            <table class="table" id="clientTable">
              <thead><tr><th>Nombre</th><th>Teléfono</th><th>Email</th><th>Notas</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Leads</h3>
            <table class="table" id="leadTable">
              <thead><tr><th>Nombre</th><th>Origen</th><th>Estado</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Actividades</h3>
            <table class="table" id="actTable">
              <thead><tr><th>Fecha</th><th>Relacionado</th><th>Tipo</th><th>Notas</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- INVENTARIO -->
      <section id="inventario" class="page">
        <div class="page-header">
          <h2>Inventario</h2>
          <div class="actions">
            <input id="itemSearch" placeholder="Buscar SKU / nombre..."/>
            <button id="addItemBtn">Nuevo Producto</button>
            <button id="addWhBtn">Nuevo Almacén</button>
            <button id="addPurchaseBtn">Compra</button>
            <button id="addSaleBtn">Venta</button>
            <button id="addTransferBtn">Transferencia</button>
            <button id="addAdjBtn">Ajuste</button>
            <button id="pdfItemsBtn" class="outline">PDF Catálogo (B/N)</button>
            <button id="pdfStockBtn" class="outline">PDF Stock (B/N)</button>
            <button id="pdfKardexBtn" class="outline">PDF Kardex (B/N)</button>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <h3>Productos</h3>
            <table class="table" id="itemsTable">
              <thead>
              <tr><th>SKU</th><th>Nombre</th><th>Categoría</th><th>Precio</th><th>Mín.</th><th>Stock</th><th>Acciones</th></tr>
              </thead><tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Almacenes</h3>
            <table class="table" id="whTable">
              <thead><tr><th>Nombre</th><th>Ubicación</th><th>Acciones</th></tr></thead><tbody></tbody>
            </table>
          </div>
          <div class="card">
            <h3>Reportes</h3>
            <div class="row">
              <input id="repSku" placeholder="SKU opcional"/>
              <button id="repStockBtn">Mostrar Existencias</button>
            </div>
            <table class="table" id="repStockTable">
              <thead><tr><th>Almacén</th><th>SKU</th><th>Nombre</th><th>Stock</th></tr></thead><tbody></tbody>
            </table>
            <div class="row mt">
              <input id="kardexSku" placeholder="SKU"/>
              <button id="kardexBtn">Ver Kardex</button>
            </div>
            <table class="table" id="kardexTable">
              <thead><tr><th>Fecha</th><th>Tipo</th><th>Detalle</th><th>Qty</th></tr></thead><tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ANALYTICS -->
      <section id="analytics" class="page">
        <h2>Analytics</h2>
        <div class="grid">
          <div class="card"><h3>Ingresos vs Gastos (6 meses)</h3><canvas id="chartFin"></canvas></div>
          <div class="card"><h3>Top 10 SKUs por ventas</h3><canvas id="chartSkus"></canvas></div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="page">
        <h2>Configuración</h2>
        <div class="grid">
          <div class="card">
            <h3>Marca</h3>
            <div class="row"><input id="brandName" placeholder="Nombre corporativo"/></div>
            <div class="row"><input id="logoFile" type="file" accept="image/*"/></div>
            <div class="row"><img id="logoPreview" class="logo-preview" alt="logo"/></div>
            <button id="saveBrandBtn">Guardar</button>
          </div>
          <div class="card">
            <h3>Seguridad</h3>
            <p class="muted">Autenticación con Firebase. Para multiusuario, invita a tu equipo.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalTitle">Título</h3>
        <button id="modalClose" aria-label="Cerrar">×</button>
      </div>
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-actions">
        <button id="modalCancel" class="outline">Cancelar</button>
        <button id="modalOk">Guardar</button>
      </div>
    </div>
  </div>
</body>
</html>
